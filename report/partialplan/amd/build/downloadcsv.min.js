define("report_partialplan/downloadcsv",["exports"],(function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;const url=M.cfg.wwwroot+"/webservice/rest/server.php";_exports.init=()=>{const customerid=null!==document.querySelector("#id_selcustomer")?document.querySelector("#id_selcustomer").value:document.querySelector('input[name="selcustomer"').value;document.querySelectorAll(".bodownload").forEach((node=>{node.addEventListener("click",(e=>{downloadcsv(e,customerid,url)}))}))};const downloadcsv=(e,customerid,url)=>{e.preventDefault();let list_of_trainees=e.target.closest("a").getAttribute("data-id");list_of_trainees=list_of_trainees.split(","),list_of_trainees=list_of_trainees.reduce(((arr,elem)=>{const aux=elem.split("_");return elem=aux.length<2?[...arr,{group:"None",billid:aux[1]}]:[...arr,{group:aux[0],billid:aux[1]}]}),[]);const xhr=new XMLHttpRequest;xhr.open("POST",url,!0);const formData=new FormData,token=document.querySelector('input[name="token"]').value;formData.append("wstoken",token),formData.append("wsfunction","report_partialplan_get_trainees"),formData.append("moodlewsrestformat","json");for(let i=0;i<list_of_trainees.length;i++){const trainee=list_of_trainees[i],hasBillid=void 0!==trainee.billid&&"undefined"!==trainee.billid,hasGroup=void 0!==trainee.group&&"undefined"!==trainee.group;if(hasBillid||hasGroup){const group=hasGroup?trainee.group.trim():"",billid=hasBillid?trainee.billid.trim():"";formData.append("params[".concat(i,"][customerid]"),parseInt(customerid)),formData.append("params[".concat(i,"][group]"),group),formData.append("params[".concat(i,"][billid]"),billid)}}xhr.send(formData),xhr.onload=event=>{onLoadFunction(xhr)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onerror=function(){window.console.log("Solicitud fallida")}},onLoadFunction=myXhr=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response);createExcelFromJSON(res)}},onProgressFunction=event=>{event.lengthComputable?window.console.log("Recibidos ".concat(event.loaded," de ").concat(event.total," bytes")):window.console.log("Recibidos ".concat(event.loaded," bytes"))},createExcelFromJSON=res=>{if(res.length>0){const titles=Object.keys(res[0]);(res=res.map((elem=>Object.values(elem)))).unshift(titles)}let csvContent="";res.forEach((row=>{csvContent+=row.join(";")+"\n"}));const blob=new Blob(["\ufeff"+csvContent],{type:"text/csv;charset=utf-16;"}),objUrl=URL.createObjectURL(blob),dr=new Date,nameFile="Trainee_list_loader_"+dr.getDate()+"."+(dr.getMonth()+1)+"."+dr.getFullYear()+".csv",link=document.createElement("a");link.setAttribute("href",objUrl),link.setAttribute("download",nameFile),link.click()}}));

//# sourceMappingURL=downloadcsv.min.js.map