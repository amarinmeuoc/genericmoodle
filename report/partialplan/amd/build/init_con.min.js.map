{"version":3,"file":"init_con.min.js","sources":["../src/init_con.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\nconst url=M.cfg.wwwroot+'/webservice/rest/server.php';\n\nexport const init = () => {\n    //Aseguramos que el token esté cargado y el selector de cliente tambien\n    areElementsLoaded('#filterformid input, #filterformid select').then((elements) => {\n        //Se obtienen los datos a enviar\n        const token=document.querySelector('input[name=\"token\"]').value;\n        const orderby = document.querySelector('input[name=\"orderby\"]');\n        const order = document.querySelector('input[name=\"order\"]');\n        const day=document.querySelector('#id_assesstimefinish_day').value;\n        const month=document.querySelector('#id_assesstimefinish_month').value;\n        const year=document.querySelector('#id_assesstimefinish_year').value;\n        const customerid=document.querySelector('#id_selcustomer').value;\n        const groupid=document.querySelector('#id_selgroup').value;; // El 0 representa todos los grupos\n        const billid=document.querySelector('#id_tebillid').value;\n        //Obtener la fecha en formato unix a partir de day month y year con el formato: d-m-Y\n        const date=new Date(year,month-1,day);\n        const unixtime=date.getTime()/1000;\n        requestResultFromServer(url,token, orderby.value, order.value, unixtime, customerid, groupid, billid);\n\n        //Se añade el evento para el botón de filtrar\n        const bofilter=document.querySelector('#id_bosubmit');\n        bofilter.addEventListener('click',()=>{\n            //Al volver a filtrar se reinincia el orden y la dirección\n            orderby.value='startdate';\n            order.value=1;\n            const groupid=document.querySelector('#id_selgroup').value;; // El 0 representa todos los grupos\n            const billid=document.querySelector('#id_tebillid').value;\n            const day=document.querySelector('#id_assesstimefinish_day').value;\n            const month=document.querySelector('#id_assesstimefinish_month').value;\n            const year=document.querySelector('#id_assesstimefinish_year').value;\n            const customerid=document.querySelector('#id_selcustomer').value;\n            const date=new Date(year,month-1,day);\n            const unixtime=date.getTime()/1000;\n            requestResultFromServer(url,token, orderby.value, order.value, unixtime, customerid, groupid, billid);\n        });\n    });\n\n}\n\n// Función para realizar la petición al servidor\nconst requestResultFromServer = (url, token, orderby, order, unixtime, customerid, groupid, billid) => {\n    const data = {\n        wstoken: token,\n        wsfunction: 'report_partialplan_get_training_plan',\n        moodlewsrestformat: 'json',\n        'params[0][orderby]': orderby,\n        'params[0][order]': order,\n        'params[0][unixtime]': parseInt(unixtime),\n        'params[0][customerid]': customerid,\n        'params[0][groupid]': groupid, \n        'params[0][billid]': billid\n    };\n\n    fetch(url, {\n        method: 'POST',\n        body: new URLSearchParams(data),\n        headers: {\n            'Content-Type': 'application/x-www-form-urlencoded',\n        },\n    })\n    .then(response => response.json())\n    .then(response => {\n        if (response.exception) {\n            displayException(response);\n        } else {\n            const responseData = response[0];\n            \n            Templates.renderForPromise('report_partialplan/content_con-ajax', responseData).then(({html, js}) => {\n                const content = document.querySelector('#content');\n                content.innerHTML = '';\n\n                Templates.appendNodeContents(content,html,js);\n            });\n\n        }\n    })\n    .catch((error) => {\n        displayException(error);\n        window.console.log('Error:', error);\n    });\n}\n\n// Función para verificar que todos los elementos seleccionados estén cargados\nconst areElementsLoaded = (selector) => {\n    return new Promise((resolve) => {\n        const checkElements = () => {\n            const elements = document.querySelectorAll(selector);\n            if (elements.length > 0 && Array.from(elements).every(elem => elem !== null)) {\n                resolve(elements);\n            } else {\n                requestAnimationFrame(checkElements);\n            }\n        };\n        checkElements();\n    });\n  };"],"names":["url","M","cfg","wwwroot","areElementsLoaded","then","elements","token","document","querySelector","value","orderby","order","day","month","year","customerid","groupid","billid","unixtime","Date","getTime","requestResultFromServer","addEventListener","data","wstoken","wsfunction","moodlewsrestformat","parseInt","fetch","method","body","URLSearchParams","headers","response","json","exception","responseData","renderForPromise","_ref","html","js","content","innerHTML","appendNodeContents","catch","error","window","console","log","selector","Promise","resolve","checkElements","querySelectorAll","length","Array","from","every","elem","requestAnimationFrame"],"mappings":"4RAEMA,IAAIC,EAAEC,IAAIC,QAAQ,4CAEJ,KAEhBC,kBAAkB,6CAA6CC,MAAMC,iBAE3DC,MAAMC,SAASC,cAAc,uBAAuBC,MACpDC,QAAUH,SAASC,cAAc,yBACjCG,MAAQJ,SAASC,cAAc,uBAC/BI,IAAIL,SAASC,cAAc,4BAA4BC,MACvDI,MAAMN,SAASC,cAAc,8BAA8BC,MAC3DK,KAAKP,SAASC,cAAc,6BAA6BC,MACzDM,WAAWR,SAASC,cAAc,mBAAmBC,MACrDO,QAAQT,SAASC,cAAc,gBAAgBC,MAC/CQ,OAAOV,SAASC,cAAc,gBAAgBC,MAG9CS,SADK,IAAIC,KAAKL,KAAKD,MAAM,EAAED,KACbQ,UAAU,IAC9BC,wBAAwBtB,IAAIO,MAAOI,QAAQD,MAAOE,MAAMF,MAAOS,SAAUH,WAAYC,QAASC,QAG/EV,SAASC,cAAc,gBAC7Bc,iBAAiB,SAAQ,KAE9BZ,QAAQD,MAAM,YACdE,MAAMF,MAAM,QACNO,QAAQT,SAASC,cAAc,gBAAgBC,MAC/CQ,OAAOV,SAASC,cAAc,gBAAgBC,MAC9CG,IAAIL,SAASC,cAAc,4BAA4BC,MACvDI,MAAMN,SAASC,cAAc,8BAA8BC,MAC3DK,KAAKP,SAASC,cAAc,6BAA6BC,MACzDM,WAAWR,SAASC,cAAc,mBAAmBC,MAErDS,SADK,IAAIC,KAAKL,KAAKD,MAAM,EAAED,KACbQ,UAAU,IAC9BC,wBAAwBtB,IAAIO,MAAOI,QAAQD,MAAOE,MAAMF,MAAOS,SAAUH,WAAYC,QAASC,qBAOpGI,wBAA0B,CAACtB,IAAKO,MAAOI,QAASC,MAAOO,SAAUH,WAAYC,QAASC,gBAClFM,KAAO,CACTC,QAASlB,MACTmB,WAAY,uCACZC,mBAAoB,4BACEhB,2BACFC,4BACGgB,SAAST,kCACPH,gCACHC,4BACDC,QAGzBW,MAAM7B,IAAK,CACP8B,OAAQ,OACRC,KAAM,IAAIC,gBAAgBR,MAC1BS,QAAS,gBACW,uCAGvB5B,MAAK6B,UAAYA,SAASC,SAC1B9B,MAAK6B,cACEA,SAASE,sCACQF,cACd,OACGG,aAAeH,SAAS,sBAEpBI,iBAAiB,sCAAuCD,cAAchC,MAAKkC,WAACC,KAACA,KAADC,GAAOA,eACnFC,QAAUlC,SAASC,cAAc,YACvCiC,QAAQC,UAAY,sBAEVC,mBAAmBF,QAAQF,KAAKC,WAKrDI,OAAOC,oCACaA,OACjBC,OAAOC,QAAQC,IAAI,SAAUH,WAK/B1C,kBAAqB8C,UAChB,IAAIC,SAASC,gBACVC,cAAgB,WACZ/C,SAAWE,SAAS8C,iBAAiBJ,UACvC5C,SAASiD,OAAS,GAAKC,MAAMC,KAAKnD,UAAUoD,OAAMC,MAAiB,OAATA,OAC1DP,QAAQ9C,UAERsD,sBAAsBP,gBAG9BA"}