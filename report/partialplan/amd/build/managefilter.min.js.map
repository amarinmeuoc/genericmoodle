{"version":3,"file":"managefilter.min.js","sources":["../src/managefilter.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\n\nexport const init = () => {\n    \n    const sdlink=document.querySelector('#sd-link');\n    const edlink=document.querySelector('#ed-link');\n\n    \n\n    sdlink.addEventListener('click',(e)=>{\n        e.preventDefault();\n        const customerid=(document.querySelector('#id_selcustomer')!==null)?document.querySelector(\"#id_selcustomer\").value:document.querySelector('input[name=\"selcustomer\"').value;\n        const order=document.querySelector('input[name=\"order\"]');\n        const orderby=document.querySelector('input[name=\"orderby\"]');\n        const day=document.querySelector('#id_assesstimefinish_day').value;\n        const month=document.querySelector('#id_assesstimefinish_month').value;\n        const year=document.querySelector('#id_assesstimefinish_year').value;\n        const group=document.querySelector('#id_selgroup').value;\n        const billid=document.querySelector('#id_tebillid').value;\n        const date=new Date(year,month-1,day);\n        const unixtime=date.getTime()/1000;\n        \n        orderby.value='startdate';\n        // Alternar el valor de order\n        order.value = order.value === '1' ? '0' : '1';\n\n        \n        \n        requestResultFromServer(customerid,group,billid,unixtime,order.value,orderby.value);\n    });\n\n    edlink.addEventListener('click',(e)=>{\n        e.preventDefault();\n        const customerid=(document.querySelector('#id_selcustomer')!==null)?document.querySelector(\"#id_selcustomer\").value:document.querySelector('input[name=\"selcustomer\"').value;\n        const order=document.querySelector('input[name=\"order\"]');\n        const orderby=document.querySelector('input[name=\"orderby\"]');\n        const day=document.querySelector('#id_assesstimefinish_day').value;\n        const month=document.querySelector('#id_assesstimefinish_month').value;\n        const year=document.querySelector('#id_assesstimefinish_year').value;\n        const group=document.querySelector('#id_selgroup').value;\n        const billid=document.querySelector('#id_tebillid').value;\n        const date=new Date(year,month-1,day);\n        const unixtime=date.getTime()/1000;\n        orderby.value='enddate';\n        order.value = order.value === '1' ? '0' : '1';\n        \n        \n        requestResultFromServer(customerid,group,billid,unixtime,order.value,orderby.value);\n    });\n    \n}\n\nconst requestResultFromServer=(customerid,group,billid,unixtime,order,orderby)=>{\n    let xhr=new XMLHttpRequest();\n    const url=M.cfg.wwwroot+'/webservice/rest/server.php';\n    const token=document.querySelector('input[name=\"token\"]').value;\n    xhr.open('POST',url,true);\n    const formData=new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction','report_partialplan_get_training_plan');\n    formData.append('moodlewsrestformat','json');\n    formData.append('params[0][customerid]',customerid);\n    formData.append('params[0][groupid]',parseInt(group));\n    formData.append('params[0][billid]',billid);\n    formData.append('params[0][unixtime]',unixtime);\n    formData.append('params[0][order]',order);\n    formData.append('params[0][orderby]',orderby);\n    \n    xhr.send(formData);\n    xhr.onload = (event) =>{\n        onLoadFunction(xhr,group,token);\n        };\n    xhr.onprogress = (event)=>{\n        onProgressFunction(event);\n    } \n    xhr.onerror = function() {\n        window.console.log(\"Solicitud fallida\");\n    };\n}\n\nconst onLoadFunction=(myXhr,selectedGroup,token)=>{\n    if (myXhr.readyState===4 && myXhr.status===200){\n        const res=JSON.parse(myXhr.response);\n        \n        showTemplateAssessment(res);\n    }\n}\n\nconst onProgressFunction= (event)=>{\n    if (event.lengthComputable) {\n      window.console.log(`Recibidos ${event.loaded} de ${event.total} bytes`);\n    } else {\n      window.console.log(`Recibidos ${event.loaded} bytes`); // sin Content-Length\n    }\n}\n\nfunction showTemplateAssessment(response){\n    \n    const content=document.querySelector('#content');\n    content.innerHTML='';\n    const responseData = response[0];\n    \n    Templates.renderForPromise('report_partialplan/content_con-ajax', responseData).then(({html, js}) => {\n        const content = document.querySelector('#content');\n        content.innerHTML = '';\n\n        Templates.appendNodeContents(content,html,js);\n    }).catch((error)=>displayException(error));\n    \n    \n  }"],"names":["sdlink","document","querySelector","edlink","addEventListener","e","preventDefault","customerid","value","order","orderby","day","month","year","group","billid","unixtime","Date","getTime","requestResultFromServer","xhr","XMLHttpRequest","url","M","cfg","wwwroot","token","open","formData","FormData","append","parseInt","send","onload","event","onLoadFunction","onprogress","onProgressFunction","onerror","window","console","log","myXhr","selectedGroup","readyState","status","response","innerHTML","responseData","renderForPromise","then","_ref","html","js","content","appendNodeContents","catch","error","showTemplateAssessment","JSON","parse","lengthComputable","loaded","total"],"mappings":"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"}