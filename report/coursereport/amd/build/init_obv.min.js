define("report_coursereport/init_obv",["exports","core/notification","core/templates"],(function(_exports,_notification,_templates){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.loadTemplate=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.loadTemplate=()=>{const url=M.cfg.wwwroot+"/webservice/rest/server.php";areElementsLoaded("#id_selCustomer,#id_grouptrainee,#id_list_trainees,#id_list_courses, input").then((elements=>{const token=document.querySelector('input[name="token"]'),orderby=document.querySelector('input[name="orderby"]'),order=document.querySelector('input[name="order"]'),page=document.querySelector('input[name="page"]'),bosubmit=document.querySelector("#id_bosubmit");requestDataToServer(order,orderby,page,token,url),bosubmit.addEventListener("click",(()=>{requestDataToServer(order,orderby,page,token,url)}))}))};const requestDataToServer=(or,orby,page,token,url)=>{const list_trainees=document.querySelector("#id_list_trainees"),list_courses=document.querySelector("#id_list_courses"),customerid=document.querySelector('input[name="selCustomer"]').value,groupSel=document.querySelector("#id_grouptrainee").value,billid=list_trainees.value,wbs=list_courses.value,startdate_day=document.querySelector("#id_startdate_day"),startdate_month=document.querySelector("#id_startdate_month"),startdate_year=document.querySelector("#id_startdate_year"),startdate=Math.floor(new Date(startdate_year.value+"."+startdate_month.value+"."+startdate_day.value).getTime()/1e3),queryType=document.querySelector('input[type="radio"][name="status"]:checked'),order=or.value,orderby=orby.value,xhr=new XMLHttpRequest;xhr.open("POST",url,!0);const formData=new FormData;formData.append("wstoken",token.value),formData.append("wsfunction","report_coursereport_get_assessment"),formData.append("moodlewsrestformat","json"),formData.append("params[0][customerid]",customerid),formData.append("params[0][groupid]",groupSel),formData.append("params[0][billid]",billid),formData.append("params[0][wbs]",wbs),formData.append("params[0][startdate]",startdate),formData.append("params[0][offset]",50),formData.append("params[0][order]",order),formData.append("params[0][orderby]",orderby),formData.append("params[0][queryType]",queryType.value),formData.append("params[0][page]",page.value),xhr.send(formData),xhr.onload=event=>{200===xhr.status&&onLoadFunction(xhr)},xhr.onerror=()=>{reject("Solicitud fallida")},xhr.onloadstart=event=>{showLoader(event)},xhr.onprogress=event=>{onProgressFunction(event)},xhr.onloadend=event=>{hideLoader(event)}},onProgressFunction=event=>{event.lengthComputable?window.console.log("Recibidos ".concat(event.loaded," de ").concat(event.total," bytes")):window.console.log("Recibidos ".concat(event.loaded," bytes"))},showLoader=event=>{const loader=document.querySelector(".loader"),table=document.querySelector(".generaltable");loader.classList.remove("hide"),loader.classList.add("show"),table.classList.add("hide")},hideLoader=event=>{const loader=document.querySelector(".loader"),table=document.querySelector(".generaltable");loader.classList.remove("show"),loader.classList.add("hide"),table.classList.remove("hide")},onLoadFunction=myXhr=>{if(4===myXhr.readyState&&200===myXhr.status){const res=JSON.parse(myXhr.response);res[0].assessment_list=res[0].assessment_list.map((obj=>(null===obj.assessment?obj.assessment="":(obj.assessment=1*obj.assessment,obj.assessment=obj.assessment.toFixed(2)),obj.attendance=1*obj.attendance,obj.attendance=obj.attendance.toFixed(2),obj))),res[0].pages=function(arr,maxLength){const activeIndex=arr.indexOf(arr.find((item=>item.active)));if(-1===activeIndex||arr.length<=maxLength)return arr;const halfLength=Math.floor(maxLength/2),beforeLength=Math.min(halfLength,activeIndex),afterLength=Math.min(halfLength,arr.length-activeIndex-1),truncatedArray=[];for(let i=activeIndex-beforeLength;i<=activeIndex+afterLength;i++)i>=0&&i<arr.length&&truncatedArray.push(arr[i]);return truncatedArray}(res[0].pages,8),response=res[0],_templates.default.renderForPromise("report_coursereport/content_obv-ajax",response).then((_ref=>{let{html:html,js:js}=_ref;const content=document.querySelector("#content");content.innerHTML="",_templates.default.appendNodeContents(content,html,js);const orderlinks=document.querySelectorAll(".orderby");orderlinks.forEach((link=>{link.addEventListener("click",(ev=>{ev.preventDefault();const token=document.querySelector('input[name="token"]'),page=document.querySelector('input[name="page"]'),orderby=document.querySelector('input[name="orderby"]'),order=document.querySelector('input[name="order"]');"activo"===ev.target.dataset.activo?"1"===order.value?(ev.target.dataset.order=0,order.value=0):(ev.target.dataset.order=1,order.value=1):(orderlinks.forEach((link=>{link.dataset.activo=""})),ev.target.dataset.activo="activo",orderby.value=ev.target.dataset.orderby,ev.target.dataset.order=1,order.value=1),requestDataToServer(order,orderby,page,token,url)}))})),document.querySelectorAll(".page-link").forEach((page=>{page.addEventListener("click",(ev=>{ev.preventDefault(),ev.stopPropagation();const token=document.querySelector('input[name="token"]'),page=document.querySelector('input[name="page"]'),padre=ev.currentTarget.parentElement;"first"===padre.dataset.control||"last"===padre.dataset.control||"previous"===padre.dataset.control||"next"===padre.dataset.control?page.value=ev.currentTarget.getAttribute("aria-label"):page.value=ev.currentTarget.textContent.trim();const orderby=document.querySelector('input[name="orderby"]'),order=document.querySelector('input[name="order"]');requestDataToServer(order,orderby,page,token,url)}))}))})).catch((error=>(0,_notification.exception)(error)))}var response};const areElementsLoaded=selector=>new Promise((resolve=>{const checkElements=()=>{const elements=document.querySelectorAll(selector);elements.length>0&&Array.from(elements).every((elem=>null!==elem))?resolve(elements):requestAnimationFrame(checkElements)};checkElements()}))}));

//# sourceMappingURL=init_obv.min.js.map