{"version":3,"file":"addTicket.min.js","sources":["../src/addTicket.js"],"sourcesContent":["import ModalForm from 'core_form/modalform';\nimport Notification from 'core/notification';\nimport {add as addToast} from 'core/toast';\nimport {get_string as getString} from 'core/str';\nimport {exception as displayException} from 'core/notification';\nimport Templates from 'core/templates';\n\n\nconst url=M.cfg.wwwroot+'/webservice/rest/server.php';\nconst token=document.querySelector('input[name=\"token\"]').value;\nlet eventoCat=\"\";\nlet eventoSubCat=\"\";\nlet eventoFile=\"\";\nlet eventoPriority=\"\";\n\nexport const init =() => {\n    const bonewticket=document.querySelector(\"#id_bocreate\");\n    bonewticket.addEventListener('click',(e)=>{\n        e.preventDefault();\n        e.stopImmediatePropagation();\n        const project=document.querySelector('#id_project').value;\n        const vessel=document.querySelector('#id_vessel').value;\n        const trainee=document.querySelector('#id_userlist').value;\n        const category=(document.querySelector('#id_category').value)?document.querySelector('#id_category').value:0;\n        const subcategory=(document.querySelector('#id_subcategory').value)?document.querySelector('#id_subcategory').value:0;\n        \n        \n        const familyissue=document.querySelector('#id_familyissue').value;\n        const description=document.querySelector('textarea[name=\"description[text]\"]').value;\n        //const fileid=document.querySelector('#id_attachments').value;\n        let familiar=trainee;\n        if (familyissue==='yes'){\n          if (document.querySelector('#id_familiar').value!=='')\n            familiar=document.querySelector('#id_familiar').value;\n        }\n        const newTicket={\n            projectid:project,\n            vesselid:vessel,\n            traineeid:trainee,\n            categoryid:category,\n            subcategoryid:subcategory,\n            state:\"Open\",\n            priority:\"Medium\",\n            description:description,\n            //fileid:fileid,\n            familiarid:familiar\n        };\n\n        if (category!==0 && subcategory!==0)\n          createNewTicket(newTicket);\n        else{\n          Notification.addNotification({message:'Error: No categories have been defined yet. No ticket has been inserted',type:'error'});\n        }\n\n    })\n}\n\nconst createNewTicket=(newTicket)=>{\n    let xhr = new XMLHttpRequest();\n    \n    //Se prepara el objeto a enviar\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction', 'local_ticketmanagement_add_ticket');\n    formData.append('moodlewsrestformat', 'json');\n    formData.append('params[0][subcategoryid]',newTicket.subcategoryid);\n    formData.append('params[0][traineeid]',newTicket.traineeid);\n    formData.append('params[0][state]',newTicket.state);\n    formData.append('params[0][priority]',newTicket.priority);\n    formData.append('params[0][description]',newTicket.description);\n    formData.append('params[0][familiarid]',newTicket.familiarid);\n\n    xhr.open('POST',url,true);\n    xhr.send(formData);\n\n    xhr.onload = (ev)=> {\n        reqHandlerNewTicket(xhr);\n    }\n\n    xhr.onerror = ()=> {\n        rejectAnswer(xhr);\n    }\n}\n\nconst reqHandlerNewTicket = (xhr) => {\n  if (xhr.readyState === 4 && xhr.status === 200) {\n      if (xhr.response) {\n          const response = JSON.parse(xhr.response);\n\n          if (response) {\n              window.console.log(response);\n              addToast('Ticket created successfully: ' + response.id);\n\n              // Actualiza el número de tickets y las páginas\n              let numRecords = parseInt(document.querySelector('#num_records').textContent.trim()) + 1;\n              let numPages = Math.ceil(numRecords / 25); // Cálculo de las páginas necesarias\n              let currentPage = numPages;\n\n              // Actualiza la lista de páginas en el paginador\n              const pageList = [];\n              let pagePrevious = Math.max(1, currentPage - 1);\n              let pageNext = currentPage + 1;\n              if (numPages===1){\n                pageNext=1;\n              }\n              \n              \n              for (let i = 1; i <= numPages; i++) {\n                  pageList.push({\n                      page: i,\n                      active: i === currentPage\n                  });\n              }\n\n              const formattedResponse = {\n                  listadoTickets: [{\n                      ticketnumber: response.id,\n                      username: response.username,\n                      familyissue: response.familyissue,\n                      state: response.state,\n                      priority: response.priority,\n                      assigned: 'Waiting to be assigned.',\n                      date: response.dateticket,\n                      description: response.description,\n                      familyissue: response.familyissue\n                  }],\n                  num_records: numRecords,\n                  num_total_records: numRecords,\n                  num_pages: numPages,\n                  pages: pageList,\n                  previous: [{\n                      page: pagePrevious,\n                      url: '#'\n                  }],\n                  next: [{\n                      page: pageNext,\n                      url: '#'\n                  }],\n                  first: [{\n                      page: 1,\n                      url: '#'\n                  }],\n                  last: [{\n                      page: numPages,\n                      url: '#'\n                  }],\n              };\n\n              addTickettoTemplate(formattedResponse);\n          } else {\n              addToast('Something went wrong. No ticket created');\n          }\n      }\n  }\n};\n\n\nfunction addTickettoTemplate(response){\n    //Render the choosen mustache template by Javascript\n    Templates.renderForPromise('local_ticketmanagement/tr_log-ajax',response)\n    .then(({html,js})=>{\n      const content=document.querySelector('#tablebody');\n      const numRecords = document.querySelectorAll('.tickets').length;\n      \n      // Si el número total de registros supera los 25, limpiar la tabla para una nueva página\n      if (numRecords >= 25) {\n        content.innerHTML = '';  // Limpiar solo cuando se supere el límite de 25 registros\n      }\n\n      Templates.appendNodeContents(content,html,js);\n      const newTicket=document.querySelectorAll('.tickets')[document.querySelectorAll('.tickets').length-1];\n      newTicket.addEventListener('click',(e)=>{\n        \n          showTicketFormPopup(e);\n        \n      });\n\n      const logs=document.querySelectorAll('.logs')[document.querySelectorAll('.logs').length-1];\n\n    \n        logs.addEventListener('click',(e)=>{\n          const filaPadre=e.target.closest('tr');\n          \n            showTicketActions(e);\n          \n        })\n   \n\n      const assignbtn=document.querySelectorAll('.assignbtn')[document.querySelectorAll('.assignbtn').length-1];\n      assignbtn.addEventListener('click',(e)=>{\n        const filaPadre=e.target.closest('tr');\n        if (!filaPadre.classList.contains('cerrado')){\n          \n          showAssigmentFormPopup(e);\n        } else {\n          e.preventDefault();\n          e.stopPropagation();\n        }\n        \n      })\n\n\n      \n\n\n\n      \n      //En caso de que se superen 25 tickets por página, se crea una nueva página y añade el registro ahí\n\n\n      Templates.renderForPromise('local_ticketmanagement/pagebar_log-ajax',response)\n      .then(({html,js})=>{\n        const content=document.querySelector('#pagination');\n        content.innerHTML='';\n        Templates.appendNodeContents(content,html,js);\n\n\n        const pages=document.querySelectorAll('.page-link');\n        pages.forEach((page)=>{\n          page.addEventListener('click',(ev)=>{\n            window.console.log('adleante');\n            ev.preventDefault();\n            ev.stopPropagation();\n            const token = document.querySelector('input[name=\"token\"]');\n            const page= document.querySelector('input[name=\"page\"]');\n    \n            //Se obtiene el elemento padre del elemento clicado\n            const padre=ev.currentTarget.parentElement;\n            \n            if (padre.dataset.control==='first' || padre.dataset.control==='last' || padre.dataset.control==='previous' || padre.dataset.control==='next'){\n              //Si es la primera página se coge el valor de arial-label\n              page.value=ev.currentTarget.getAttribute('aria-label');\n            } else {\n              page.value=ev.currentTarget.textContent.trim();\n            }\n            \n            //Obtenemos el ordenamiento y el campo de orden actuales\n            const orderby = document.querySelector('input[name=\"orderby\"]').value;\n            const order = document.querySelector('input[name=\"order\"]').value;\n            const activePage=parseInt(page.value);\n            const startdate= document.querySelector('#startdate');\n            const enddate= document.querySelector('#enddate');\n    \n            const startdateUnixFormat=truncateDateToDay(new Date(startdate.value));\n            const enddateUnixFormat=truncateDateToDay(new Date(enddate.value));\n    \n            requestDataToServer(activePage,startdateUnixFormat, enddateUnixFormat,parseInt(order), orderby, parseInt(page.value), token.value, url);\n          });\n        });\n        \n      }).catch((error)=>displayException(error));\n    }).catch((error)=>displayException(error));\n  }\n\n  const truncateDateToDay=(date) =>{\n    // Create a new Date object with the year, month, and date from the input date.\n    const truncatedDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n  \n    // Convert the truncated date to Unix time (milliseconds since the Unix epoch).\n    const unixTime = truncatedDate.getTime() / 1000; // Divide by 1000 to get seconds\n  \n    return unixTime;\n  }\n\n  const requestDataToServer=(activePage,firstDayOfWeek, lastDayOfWeek, order,orderby,page,token,url)=>{\n    let xhr = new XMLHttpRequest();\n      \n      //Se prepara el objeto a enviar\n      const formData= new FormData();\n      formData.append('wstoken',token);\n      formData.append('wsfunction', 'local_ticketmanagement_get_tickets');\n      formData.append('moodlewsrestformat', 'json');\n      formData.append('params[0][order]',order);\n      formData.append('params[0][orderby]',orderby);\n      formData.append('params[0][page]',page);\n      formData.append('params[0][startdate]',firstDayOfWeek);\n      formData.append('params[0][enddate]',lastDayOfWeek);\n      formData.append('params[0][activePage]',activePage);\n      \n      \n  \n      xhr.open('POST',url,true);\n      xhr.send(formData);\n  \n      xhr.onload = (ev)=> {\n          reqHandlerGetTickets(xhr);\n      }\n  \n      xhr.onerror = ()=> {\n          rejectAnswer(xhr);\n      }\n  }\n\n  const reqHandlerGetTickets=(xhr)=>{\n    if (xhr.readyState=== 4 && xhr. status === 200){\n      if (xhr.response){\n          const response=JSON.parse(xhr.response);\n          loadTemplatefromResponse(response);\n          \n      }\n   }\n  }\n  \n  const loadTemplatefromResponse=(response)=>{\n    //Render the choosen mustache template by Javascript\n    Templates.renderForPromise('local_ticketmanagement/content_log-ajax',response)\n    .then(({html,js})=>{\n    const content=document.querySelector('#content');\n    content.innerHTML='';\n      Templates.appendNodeContents(content,html,js);\n      \n      //Ahora que se ha cargado la plantilla, se puede añadir el evento a los enlaces de ordenación\n      const orderlinks=document.querySelectorAll('.orderby');\n      orderlinks.forEach((link)=>{\n        link.addEventListener('click',(ev)=>{\n          ev.preventDefault();\n  \n          //Se obtienen los valores de los campos necesarios\n          const token = document.querySelector('input[name=\"token\"]').value;\n          const page= document.querySelector('input[name=\"page\"]');\n  \n          //Obtenemos el ordenamiento y el campo de orden actuales\n          const orderby = document.querySelector('input[name=\"orderby\"]');\n          const order = document.querySelector('input[name=\"order\"]');\n  \n          //Si el campo de ordenamiento es el mismo que el actual, se cambia el orden\n          if (ev.target.dataset.activo==='activo'){\n            if (order.value==='1'){\n              ev.target.dataset.order=0;\n              order.value=0;\n            } else {\n              ev.target.dataset.order=1;\n              order.value=1;\n            }\n          } else {\n            orderlinks.forEach((link)=>{\n              link.dataset.activo='';\n            });\n            ev.target.dataset.activo='activo';\n            orderby.value=ev.target.dataset.orderby;\n            ev.target.dataset.order=1;\n            order.value=1;\n          }\n  \n          const activePage=document.querySelector('li.page-item.active>a').textContent.trim();\n  \n          const startdate= document.querySelector('#startdate');\n          const enddate= document.querySelector('#enddate');\n  \n          const startdateUnixFormat=truncateDateToDay(new Date(startdate.value));\n          const enddateUnixFormat=truncateDateToDay(new Date(enddate.value));\n          \n          requestDataToServer(activePage,startdateUnixFormat, enddateUnixFormat, parseInt(order.value),orderby.value,page.value,token,url);\n        });\n      });\n  \n      const pages=document.querySelectorAll('.page-link');\n      pages.forEach((page)=>{\n        page.addEventListener('click',(ev)=>{\n          ev.preventDefault();\n          ev.stopPropagation();\n          const token = document.querySelector('input[name=\"token\"]');\n          const page= document.querySelector('input[name=\"page\"]');\n  \n          //Se obtiene el elemento padre del elemento clicado\n          const padre=ev.currentTarget.parentElement;\n          \n          if (padre.dataset.control==='first' || padre.dataset.control==='last' || padre.dataset.control==='previous' || padre.dataset.control==='next'){\n            //Si es la primera página se coge el valor de arial-label\n            page.value=ev.currentTarget.getAttribute('aria-label');\n          } else {\n            page.value=ev.currentTarget.textContent.trim();\n          }\n          \n          //Obtenemos el ordenamiento y el campo de orden actuales\n          const orderby = document.querySelector('input[name=\"orderby\"]').value;\n          const order = document.querySelector('input[name=\"order\"]').value;\n          const activePage=parseInt(page.value);\n          const startdate= document.querySelector('#startdate');\n          const enddate= document.querySelector('#enddate');\n  \n          const startdateUnixFormat=truncateDateToDay(new Date(startdate.value));\n          const enddateUnixFormat=truncateDateToDay(new Date(enddate.value));\n  \n          requestDataToServer(activePage,startdateUnixFormat, enddateUnixFormat,parseInt(order), orderby, parseInt(page.value), token.value, url);\n        });\n      });\n  \n    })\n    .catch((error)=>displayException(error));\n  }\n\n  const showTicketFormPopup=(e)=>{\n    e.stopPropagation();\n    const ticketId=e.target.textContent.trim();\n    \n    const modalForm=new ModalForm({\n        formClass: \"\\\\local_ticketmanagement\\\\form\\\\TicketFormPopup\",\n        args: {num_ticket: ticketId},\n        modalConfig: {title: `Ticket details: #${ticketId}`},\n        returnFocus:e.target\n    });\n\n    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e)=>{\n         //Se actualiza la pagina principal con los nuevos valores y se envia email de notificación\n         const formElement=e.target;\n         const subcategoryValue = formElement.querySelector('select[name=\"subcategory\"]')?.value;\n         window.console.log(e.detail);\n         if (subcategoryValue) {\n             e.detail.subcategory = subcategoryValue;\n         }\n \n \n         updateTicket(e.detail,token,url);\n    });\n\n    modalForm.addEventListener(modalForm.events.LOADED, (e)=>{\n        // Obtener el formulario modal después de que se ha cargado\n        const formElement = e.target;\n        window.console.log(\"disabled...\");\n        // Usa la función areElementsLoaded para esperar hasta que los selectores estén cargados en el DOM\n        areElementsLoaded('select[name=\"category\"], select[name=\"subcategory\"]', formElement).then((elements) => {\n\n            // Una vez que los selectores están disponibles, los seleccionamos\n            const categorySelect = formElement.querySelector('select[name=\"category\"]');\n            const subcategorySelect = formElement.querySelector('select[name=\"subcategory\"]');\n            const priority=formElement.querySelector('select[name=\"priority\"]');\n            priority.addEventListener('change',(e)=>{\n              eventoPriority=e.target.value\n            })\n    \n            // Asegúrate de que ambos selectores existen\n            if (categorySelect && subcategorySelect) {\n                // Añadir un listener para cuando cambie la categoría seleccionada\n                categorySelect.addEventListener('change', (event) => {\n                    const selectedCategory = event.target.value;\n                    window.console.log(`Categoría seleccionada: ${selectedCategory}`);\n                    eventoCat=event.target.value;\n                    // Lógica para actualizar las opciones del selector de subcategorías\n                    updateSubcategory(selectedCategory, subcategorySelect,token);\n                });\n                subcategorySelect.addEventListener('change',(e)=>{\n                  eventoSubCat=e.target.value;\n              })\n            } else {\n                window.console.error('Los selectores de categoría y subcategoría no están disponibles.');\n            }\n\n            const closebox=formElement.querySelector(\"input[type='checkbox'][name='close']\");\n            const cancelledbox=formElement.querySelector(\"input[type='checkbox'][name='cancelled']\");\n            const bosave=formElement.querySelector(\".btn-primary\");\n            \n            if (closebox.checked){\n              bosave.disabled=true;\n              closebox.disabled=true;\n            }\n\n\n            if (cancelledbox.checked){\n              bosave.disabled=true;\n              cancelledbox.disabled=true;\n            }\n            \n        }).catch((error) => {\n            window.console.error('Error al cargar los elementos select:', error);\n        });\n        \n        }\n    );\n    \n    modalForm.show();\n\n}\n\nconst showAssigmentFormPopup=(e)=>{\n  e.stopPropagation();\n  const fila=e.target.closest('tr');\n  const ticket=fila.querySelector('.tickets');\n  const ticketId=ticket.textContent;\n  const modalForm=new ModalForm({\n      formClass: \"\\\\local_ticketmanagement\\\\form\\\\AssignmentFormPopup\",\n      args: {num_ticket: ticketId},\n      modalConfig: {title: `Ticket details: #${ticketId}`},\n      returnFocus:e.target\n  });\n\n  modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e)=>{\n      //Se actualiza la pagina principal con los nuevos valores y se envia email de notificación\n        \n      const ticket=e.detail.ticket;\n      const td=document.querySelector(`td a.assignbtn[data-ticketid=\"${ticket.id}\"]`).parentElement;\n      const link=document.querySelector(`a.assignbtn[data-ticketid=\"${ticket.id}\"]`)\n      const span = link.nextElementSibling; \n      span.textContent=ticket.user;\n      const state=document.querySelector(`td a.assignbtn[data-ticketid=\"${ticket.id}\"]`).parentElement.parentElement.children[4];\n      state.textContent=ticket.state;\n  });\n\n  modalForm.addEventListener(modalForm.events.LOADED, (e)=>{\n      //Changing the text of the dynamic button\n      //e.target.querySelector(\"button[data-action='save']\").textContent=\"Send Email\"\n      \n      }\n  );\n  \n  modalForm.show();\n\n}\n\nconst showTicketActions=(e)=>{\n  e.stopPropagation();\n  const ticketId=e.target.dataset.ticketid;\n  const modalForm=new ModalForm({\n      formClass: \"\\\\local_ticketmanagement\\\\form\\\\ActionsFormPopup\",\n      args: {num_ticket: ticketId},\n      modalConfig: {title: `Ticket details: #${ticketId}`},\n      returnFocus:e.target\n  });\n\n  modalForm.show();\n\n\n  modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e)=>{\n      //Se actualiza la pagina principal con los nuevos valores y se envia email de notificación\n  });\n\n  // Listen for the modal LOADED event\n  modalForm.addEventListener(modalForm.events.LOADED, (e) => {\n      // Get the button after the modal is fully loaded\n      // Get the modal element after it is loaded\n      \n      areElementsLoaded('#boactionid').then((elements)=>{\n          const addActionBtn = (elements.length>0)?elements[0]:null;\n          \n          if (addActionBtn) {\n              // Add an event listener to the button\n              addActionBtn.addEventListener('click', function() {\n                  console.log('Add Action button clicked!');\n              });\n          }\n\n      })\n  });\n}\n\nconst updateTicket = (obj,token,url)=>{\n  let xhr = new XMLHttpRequest();\n    \n    //Se prepara el objeto a enviar\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction', 'local_ticketmanagement_edit_ticket');\n    formData.append('moodlewsrestformat', 'json');\n    formData.append('params[0][ticketid]',obj.ticketid);\n    formData.append('params[0][fileid]',obj.attachments);\n    formData.append('params[0][cancelled]',obj.cancelled);\n    formData.append('params[0][state]',obj.hiddenstate);\n    formData.append('params[0][priority]',obj.priority);\n    formData.append('params[0][closed]',obj.close);\n    formData.append('params[0][category]',obj.subcategory);\n    formData.append('params[0][eventoCat]',eventoCat);\n    formData.append('params[0][eventoSubCat]',eventoSubCat);\n    formData.append('params[0][eventoPriority]',eventoPriority);\n\n    xhr.open('POST',url,true);\n    xhr.send(formData);\n\n    xhr.onload = (ev)=> {\n        reqHandlerUpdateTicket(xhr);\n    }\n\n    xhr.onerror = ()=> {\n        rejectAnswer(xhr);\n    }\n\n}\n\nconst reqHandlerUpdateTicket=(xhr)=>{\n  if (xhr.readyState=== 4 && xhr. status === 200){\n      if (xhr.response){\n          const response=JSON.parse(xhr.response);\n          \n          if (response){\n            window.console.log(response.ticket);\n            const ticket=response.ticket;\n            updateTemplate(ticket);\n          }\n          \n      }\n    }\n}\n\nconst updateTemplate=(ticket)=>{\n  const fila = document.querySelector(`#${ticket.ticketid}`);\n  const state = fila.querySelector('td:nth-child(5)');\n  const priority = fila.querySelector('td:nth-child(7)');\n  state.textContent=ticket.state;\n  priority.textContent=ticket.priority;\n  window.console.log(fila.querySelector('.assignbtn'));\n    if (ticket.state==='Closed' || ticket.state==='Cancelled'){\n        fila.classList.add(\"cerrado\");\n        const boAssigment=fila.querySelector('.assignbtn');\n        boAssigment.addEventListener(\"click\", (event) => {\n            event.stopPropagation(); // Detener la propagación del evento\n            event.preventDefault();  // Prevenir cualquier acción predeterminada\n        });\n        // Opcional: cambiar el cursor a \"not-allowed\" para indicar que no es clickeable\n        boAssigment.style.cursor = \"not-allowed\";\n    }\n\n}\n\nconst updateSubcategory= (categoryid,subcategorySelect, token)=>{\n  let xhr = new XMLHttpRequest();\n    \n    //Se prepara el objeto a enviar\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction', 'local_ticketmanagement_load_subcategories');\n    formData.append('moodlewsrestformat', 'json');\n    formData.append('params[0][categoryid]',categoryid);\n\n    xhr.open('POST',url,true);\n    xhr.send(formData);\n\n    xhr.onload = (ev)=> {\n        reqHandlerLoadSubcategories(xhr, subcategorySelect);\n    }\n\n    xhr.onerror = ()=> {\n        rejectAnswer(xhr);\n    }\n}\n\nconst reqHandlerLoadSubcategories=(xhr,subcategorySelect)=>{\n  if (xhr.readyState=== 4 && xhr. status === 200){\n    if (xhr.response){\n        const response=JSON.parse(xhr.response);\n        const selsubcategory=subcategorySelect;\n        if (response){\n          selsubcategory.innerHTML='';\n          const optionsSubcategories = response;\n          \n\n          optionsHTML='';\n          optionsSubcategories.forEach(optionData=>{\n                optionsHTML += `<option value=\"${optionData.id}\">${optionData.subcategory}</option>`;\n          })\n          selsubcategory.innerHTML = optionsHTML;\n        }\n        \n    }\n  }\n}\n\nconst areElementsLoaded = (selector, parentElement = document) => {\n  return new Promise((resolve) => {\n      const checkElements = () => {\n          const elements = parentElement.querySelectorAll(selector);\n          if (elements.length > 0 && Array.from(elements).every(elem => elem !== null)) {\n              resolve(elements);\n          } else {\n              requestAnimationFrame(checkElements);\n          }\n      };\n      checkElements();\n  });\n};"],"names":["url","M","cfg","wwwroot","token","document","querySelector","value","eventoCat","eventoSubCat","eventoPriority","addEventListener","e","preventDefault","stopImmediatePropagation","project","vessel","trainee","category","subcategory","familyissue","description","familiar","createNewTicket","projectid","vesselid","traineeid","categoryid","subcategoryid","state","priority","familiarid","addNotification","message","type","newTicket","xhr","XMLHttpRequest","formData","FormData","append","open","send","onload","ev","reqHandlerNewTicket","onerror","rejectAnswer","readyState","status","response","JSON","parse","window","console","log","id","numRecords","parseInt","textContent","trim","numPages","Math","ceil","currentPage","pageList","pagePrevious","max","pageNext","i","push","page","active","renderForPromise","then","_ref","html","js","content","querySelectorAll","length","innerHTML","appendNodeContents","showTicketFormPopup","target","closest","showTicketActions","classList","contains","stopPropagation","showAssigmentFormPopup","_ref2","forEach","padre","currentTarget","parentElement","dataset","control","getAttribute","orderby","order","activePage","startdate","enddate","startdateUnixFormat","truncateDateToDay","Date","enddateUnixFormat","requestDataToServer","catch","error","addTickettoTemplate","listadoTickets","ticketnumber","username","assigned","date","dateticket","num_records","num_total_records","num_pages","pages","previous","next","first","last","getFullYear","getMonth","getDate","getTime","firstDayOfWeek","lastDayOfWeek","reqHandlerGetTickets","loadTemplatefromResponse","_ref3","orderlinks","link","activo","ticketId","modalForm","ModalForm","formClass","args","num_ticket","modalConfig","title","returnFocus","events","FORM_SUBMITTED","subcategoryValue","_formElement$querySel","detail","updateTicket","LOADED","formElement","areElementsLoaded","elements","categorySelect","subcategorySelect","event","selectedCategory","updateSubcategory","closebox","cancelledbox","bosave","checked","disabled","show","ticket","nextElementSibling","user","children","ticketid","addActionBtn","obj","attachments","cancelled","hiddenstate","close","reqHandlerUpdateTicket","updateTemplate","fila","add","boAssigment","style","cursor","reqHandlerLoadSubcategories","selsubcategory","optionsHTML","optionData","selector","Promise","resolve","checkElements","Array","from","every","elem","requestAnimationFrame"],"mappings":"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"}