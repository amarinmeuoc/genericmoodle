{"version":3,"file":"editFamiliar.min.js","sources":["../src/editFamiliar.js"],"sourcesContent":["import ModalForm from 'core_form/modalform';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport modalEvents from 'core/modal_events';\nimport {get_string as getString} from 'core/str';\n\nconst url=M.cfg.wwwroot+'/webservice/rest/server.php';\nconst token=document.querySelector('input[name=\"token\"]').value;\n\nexport const init =() => {\n    //definicion de url\n    const boedit=document.querySelectorAll('.edit');\n\n    boedit.forEach(elem=>{\n        \n        elem.addEventListener('click',(e)=>{\n            window.console.log(e);\n            const id=e.target.dataset.id;\n            \n            showEditFamilyPopup(id);\n        })\n    })\n\n    \n\n}\n\nconst showEditFamilyPopup=(id)=>{\n    const modalForm=new ModalForm({\n        formClass: \"\\\\local_ticketmanagement\\\\form\\\\EditFamiliarFormPopup\",\n        args: {id: id},\n        modalConfig: {title: `Edit Family member`},\n        returnFocus:e.target\n    });\n\n    modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e)=>{\n        //Se actualiza la pagina principal con los nuevos valores y se envia email de notificaciÃ³n\n        const userid=e.detail.userid;\n        const relationship=e.detail.selrelationship;\n        const firstname=e.detail.firstname;\n        const lastname=e.detail.lastname;\n        addFamiliar(userid,relationship,firstname,lastname,token,url);\n    });\n\n    modalForm.addEventListener(modalForm.events.LOADED, (e)=>{\n        //Changing the text of the dynamic button\n        //e.target.querySelector(\"button[data-action='save']\").textContent=\"Send Email\"\n        \n        }\n    );\n    \n    modalForm.show();\n}\n\nconst addFamiliar=(userid,relationship,firstname,lastname,token,url)=>{\n    let xhr = new XMLHttpRequest();\n    \n    //Se prepara el objeto a enviar\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction', 'local_ticketmanagement_add_family_members');\n    formData.append('moodlewsrestformat', 'json');\n    formData.append('params[0][userid]',userid);\n    formData.append('params[0][relationship]',relationship);\n    formData.append('params[0][firstname]',firstname);\n    formData.append('params[0][lastname]',lastname);\n    \n\n    xhr.open('POST',url,true);\n    xhr.send(formData);\n\n    xhr.onload = (ev)=> {\n        reqHandlerAddFamiliar(xhr);\n    }\n\n    xhr.onerror = ()=> {\n        rejectAnswer(xhr);\n    }\n}\n\nconst reqHandlerAddFamiliar=(xhr)=>{\n    if (xhr.readyState === 4 && xhr.status === 200) {\n        if (xhr.response) {\n            const response = JSON.parse(xhr.response);\n            if (response) {\n                window.console.log(response);\n                addFamiliarToTemplate(response);\n            }\n        }\n    }\n}\n\nconst addFamiliarToTemplate=(response)=>{\n    \n    Templates.renderForPromise('local_ticketmanagement/tr_family',response)\n        .then(({html,js})=>{\n        const content=document.querySelector('#tablebody');\n        \n          Templates.appendNodeContents(content,html,js);\n        })\n        .catch((error)=>displayException(error));\n  }"],"names":["url","M","cfg","wwwroot","token","document","querySelector","value","querySelectorAll","forEach","elem","addEventListener","e","window","console","log","id","target","dataset","showEditFamilyPopup","modalForm","ModalForm","formClass","args","modalConfig","title","returnFocus","events","FORM_SUBMITTED","userid","detail","relationship","selrelationship","firstname","lastname","addFamiliar","LOADED","show","xhr","XMLHttpRequest","formData","FormData","append","open","send","onload","ev","reqHandlerAddFamiliar","onerror","rejectAnswer","readyState","status","response","JSON","parse","addFamiliarToTemplate","renderForPromise","then","_ref","html","js","content","appendNodeContents","catch","error","displayException"],"mappings":"ukBAMMA,IAAIC,EAAEC,IAAIC,QAAQ,8BAClBC,MAAMC,SAASC,cAAc,uBAAuBC,oBAEvC,KAEFF,SAASG,iBAAiB,SAEhCC,SAAQC,OAEXA,KAAKC,iBAAiB,SAASC,IAC3BC,OAAOC,QAAQC,IAAIH,SACbI,GAAGJ,EAAEK,OAAOC,QAAQF,GAE1BG,oBAAoBH,iBAQ1BG,oBAAqBH,WACjBI,UAAU,IAAIC,mBAAU,CAC1BC,UAAW,wDACXC,KAAM,CAACP,GAAIA,IACXQ,YAAa,CAACC,4BACdC,YAAYd,EAAEK,SAGlBG,UAAUT,iBAAiBS,UAAUO,OAAOC,gBAAiBhB,UAEnDiB,OAAOjB,EAAEkB,OAAOD,OAChBE,aAAanB,EAAEkB,OAAOE,gBACtBC,UAAUrB,EAAEkB,OAAOG,UACnBC,SAAStB,EAAEkB,OAAOI,SACxBC,YAAYN,OAAOE,aAAaE,UAAUC,SAAS9B,MAAMJ,QAG7DoB,UAAUT,iBAAiBS,UAAUO,OAAOS,QAASxB,QAOrDQ,UAAUiB,QAGRF,YAAY,CAACN,OAAOE,aAAaE,UAAUC,SAAS9B,MAAMJ,WACxDsC,IAAM,IAAIC,qBAGRC,SAAU,IAAIC,SACpBD,SAASE,OAAO,UAAUtC,OAC1BoC,SAASE,OAAO,aAAc,6CAC9BF,SAASE,OAAO,qBAAsB,QACtCF,SAASE,OAAO,oBAAoBb,QACpCW,SAASE,OAAO,0BAA0BX,cAC1CS,SAASE,OAAO,uBAAuBT,WACvCO,SAASE,OAAO,sBAAsBR,UAGtCI,IAAIK,KAAK,OAAO3C,KAAI,GACpBsC,IAAIM,KAAKJ,UAETF,IAAIO,OAAUC,KACVC,sBAAsBT,MAG1BA,IAAIU,QAAU,KACVC,aAAaX,OAIfS,sBAAuBT,SACF,IAAnBA,IAAIY,YAAmC,MAAfZ,IAAIa,QACxBb,IAAIc,SAAU,OACRA,SAAWC,KAAKC,MAAMhB,IAAIc,UAC5BA,WACAvC,OAAOC,QAAQC,IAAIqC,UACnBG,sBAAsBH,aAMhCG,sBAAuBH,8BAEfI,iBAAiB,mCAAmCJ,UACzDK,MAAKC,WAACC,KAACA,KAADC,GAAMA,eACPC,QAAQxD,SAASC,cAAc,iCAEzBwD,mBAAmBD,QAAQF,KAAKC,OAE3CG,OAAOC,OAAQC,iBAAiBD"}