{"version":3,"file":"init.min.js","sources":["../../src/usermanagement/init.js"],"sourcesContent":["define([\n    'core/notification', \n    'core/templates', \n    'local_ticketmanagement/funciones_comunes' // Ajusta la ruta según sea necesario\n], function(Notification, Templates, funcionesComunes){\n  const loadTemplate =() => {\n    //definicion de url\n    const url=M.cfg.wwwroot+'/webservice/rest/server.php';\n\n    funcionesComunes.areElementsLoaded('#id_project,#id_vessel,input[name=\"token\"]').then((elements) => {\n      //Se obtienen los valores de los campos necesarios\n      const token = document.querySelector('input[name=\"token\"]').value;\n      const boshow=document.querySelector('#id_boshow');\n      \n\n      boshow.addEventListener('click',()=>{\n        const newPage=document.querySelector('input[name=\"page\"]');\n        newPage.value=1;\n        const orderby = document.querySelector('input[name=\"orderby\"]').value;\n        const order = document.querySelector('input[name=\"order\"]').value;\n        const groupid = document.querySelector('#id_vessel').value;\n        const customerid= document.querySelector('#id_project').value;\n                \n        const obj={\n          activePage:1,\n          order:order,\n          orderby:orderby,\n          page:newPage.value,\n          groupid:groupid,\n          customerid:customerid\n        }\n        \n        requestDataToServer(obj, token, url);\n      });\n\n      const bosearch=document.querySelector('#id_bosearchdate');\n      bosearch.addEventListener('click',()=>{\n        const newPage=document.querySelector('input[name=\"page\"]');\n        newPage.value=1;\n        const orderby = document.querySelector('input[name=\"orderby\"]').value;\n        const order = document.querySelector('input[name=\"order\"]').value;\n        const groupid = document.querySelector('#id_vessel').value;\n        const customerid= document.querySelector('#id_project').value;\n        const billid=document.querySelector('#tebillid').value;\n        const nombre=document.querySelector('#tenombre').value;\n        const apellidos=document.querySelector('#teapellidos').value;\n                \n        const obj={\n          activePage:1,\n          order:order,\n          orderby:orderby,\n          page:newPage.value,\n          groupid:groupid,\n          customerid:customerid,\n          billid:billid,\n          nombre:nombre,\n          apellidos:apellidos\n        }\n        \n        requestDataToServer(obj, token, url);\n      });\n\n      \n    });\n  }\n\n  const requestDataToServer=(obj,token,url)=>{\n    \n    let xhr = new XMLHttpRequest();\n\n    const service= 'local_ticketmanagement_get_list_users';\n\n    //Se prepara el objeto a enviar\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction', service);\n    formData.append('moodlewsrestformat', 'json');\n    formData.append('params[0][customerid]',obj.customerid);\n    formData.append('params[0][groupid]',obj.groupid);\n    formData.append('params[0][order]',obj.order);\n    formData.append('params[0][orderby]',obj.orderby);\n    formData.append('params[0][page]',obj.page);\n    formData.append('params[0][activePage]',obj.activePage);\n    if ('billid' in obj){\n      formData.append('params[0][billid]',obj.billid);\n    }\n    if ('nombre' in obj){\n      formData.append('params[0][firstname]',obj.nombre);\n    }\n    if ('apellidos' in obj){\n      formData.append('params[0][lastname]',obj.apellidos);\n    }\n    \n    \n    xhr.open('POST',url,true);\n    //xhr.send(formData);\n\n    setTimeout(()=>{\n        xhr.send(formData);\n    },100);\n\n    xhr.onload = (ev)=> {\n        reqHandlerGetUsers(xhr);\n    }\n\n    xhr.onloadstart=(event)=>{\n        //self.showLoader(event);\n        }\n\n    xhr.onprogress = (event)=>{\n        //self.onProgressFunction(event);\n    } \n    xhr.onloadend=(event)=>{\n        //self.hideLoader(event);\n    }\n\n    xhr.onerror = ()=> {\n        //self.rejectAnswer(xhr);\n    }\n}\n\nconst reqHandlerGetUsers=(xhr)=>{\n  if (xhr.readyState=== 4 && xhr. status === 200){\n    if (xhr.response){\n        const response=JSON.parse(xhr.response);\n       \n        loadTemplateFromResponse(response);\n    }\n  }\n}\n\nconst loadTemplateFromResponse=(response)=>{\n  \n            const template='local_ticketmanagement/users/table-users-ajax'\n            //Render the choosen mustache template by Javascript\n            Templates.renderForPromise(template,response)\n            .then(({html,js})=>{\n                const content=document.querySelector('#content');\n                content.innerHTML='';\n                Templates.appendNodeContents(content,html,js);\n                \n                //Ahora que se ha cargado la plantilla, se puede añadir el evento a los enlaces de ordenación\n                const orderlinks=document.querySelectorAll('.orderby');\n                orderlinks.forEach((link)=>{\n                    link.addEventListener('click',(ev)=>{\n                        ev.preventDefault();\n                \n                        //Se obtienen los valores de los campos necesarios\n                        const token = document.querySelector('input[name=\"token\"]').value;\n                \n                        //Obtenemos el ordenamiento y el campo de orden actuales\n                        const orderby = document.querySelector('input[name=\"orderby\"]');\n                        const order = document.querySelector('input[name=\"order\"]');\n                        \n                        //Si el campo de ordenamiento es el mismo que el actual, se cambia el orden\n                        if (ev.target.dataset.activo==='activo'){\n                            if (order.value==='1'){\n                                ev.target.dataset.order=0;\n                                order.value=0;\n                            } else {\n                                ev.target.dataset.order=1;\n                                order.value=1;\n                            }\n                        } else {\n                            orderlinks.forEach((link)=>{\n                                link.dataset.activo='';\n                            });\n                            ev.target.dataset.activo='activo';\n                            orderby.value=ev.target.dataset.orderby;\n                            ev.target.dataset.order=1;\n                            order.value=1;\n                        }\n                \n                        const groupid = document.querySelector('#id_vessel').value;\n                        const customerid= document.querySelector('#id_project').value;\n                                \n                        const obj={\n                          activePage:1,\n                          order:order.value,\n                          orderby:orderby.value,\n                          page:1,\n                          groupid:groupid,\n                          customerid:customerid\n                        }\n\n                        const billid=document.querySelector('#tebillid').value;\n                        const nombre=document.querySelector('#tenombre').value;\n                        const apellidos=document.querySelector('#teapellidos').value;\n\n                        if (billid!=='' || nombre!=='' || apellidos !==''){\n                          obj.billid=billid;\n                          obj.nombre=nombre;\n                          obj.apellidos=apellidos;\n                        }\n\n                        \n                        requestDataToServer(obj, token, url);\n                \n                      \n                    });\n                });\n            \n                const pages=document.querySelectorAll('.page-link');\n                pages.forEach((page)=>{\n                    page.addEventListener('click',(ev)=>{\n                        ev.preventDefault();\n                        ev.stopPropagation();\n                        const token = document.querySelector('input[name=\"token\"]').value;\n                        const page= document.querySelector('input[name=\"page\"]');\n                \n                        //Se obtiene el elemento padre del elemento clicado\n                        const padre=ev.currentTarget.parentElement;\n                        \n                        if (padre.dataset.control==='first' || padre.dataset.control==='last' || padre.dataset.control==='previous' || padre.dataset.control==='next'){\n                        //Si es la primera página se coge el valor de arial-label\n                        page.value=ev.currentTarget.getAttribute('aria-label');\n                        } else {\n                        page.value=ev.currentTarget.textContent.trim();\n                        }\n                        \n                        //Obtenemos el ordenamiento y el campo de orden actuales\n                        const orderby = document.querySelector('input[name=\"orderby\"]').value;\n                        const order = document.querySelector('input[name=\"order\"]').value;\n                        const activePage=parseInt(page.value);\n                        \n                        const groupid = document.querySelector('#id_vessel').value;\n                        const customerid= document.querySelector('#id_project').value;\n                                \n                        const obj={\n                          activePage:activePage,\n                          order:order,\n                          orderby:orderby,\n                          page:page.value,\n                          groupid:groupid,\n                          customerid:customerid\n                        }\n\n                        const billid=document.querySelector('#tebillid').value;\n                        const nombre=document.querySelector('#tenombre').value;\n                        const apellidos=document.querySelector('#teapellidos').value;\n\n                        if (billid!=='' || nombre!=='' || apellidos !==''){\n                          obj.billid=billid;\n                          obj.nombre=nombre;\n                          obj.apellidos=apellidos;\n                        }\n                        \n                        requestDataToServer(obj, token, url);\n                       \n                        \n                \n                        \n                    });\n                });\n\n                \n            \n            })\n            .catch((error)=>displayException(error));\n}\n\n  return {\n    loadTemplate:loadTemplate\n  };\n});\n\n"],"names":["define","Notification","Templates","funcionesComunes","requestDataToServer","obj","token","url","xhr","XMLHttpRequest","formData","FormData","append","customerid","groupid","order","orderby","page","activePage","billid","nombre","apellidos","open","setTimeout","send","onload","ev","reqHandlerGetUsers","onloadstart","event","onprogress","onloadend","onerror","readyState","status","response","JSON","parse","loadTemplateFromResponse","renderForPromise","then","_ref","html","js","content","document","querySelector","innerHTML","appendNodeContents","orderlinks","querySelectorAll","forEach","link","addEventListener","preventDefault","value","target","dataset","activo","stopPropagation","padre","currentTarget","parentElement","control","getAttribute","textContent","trim","parseInt","catch","error","displayException","loadTemplate","M","cfg","wwwroot","areElementsLoaded","elements","newPage"],"mappings":"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"}