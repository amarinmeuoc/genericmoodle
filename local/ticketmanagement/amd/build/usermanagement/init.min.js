define("local_ticketmanagement/usermanagement/init",["core/notification","core/templates","local_ticketmanagement/funciones_comunes"],(function(Notification,Templates,funcionesComunes){const requestDataToServer=(obj,token,url)=>{let xhr=new XMLHttpRequest;const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","local_ticketmanagement_get_list_users"),formData.append("moodlewsrestformat","json"),formData.append("params[0][customerid]",obj.customerid),formData.append("params[0][groupid]",obj.groupid),formData.append("params[0][order]",obj.order),formData.append("params[0][orderby]",obj.orderby),formData.append("params[0][page]",obj.page),formData.append("params[0][activePage]",obj.activePage),"billid"in obj&&formData.append("params[0][billid]",obj.billid),"nombre"in obj&&formData.append("params[0][firstname]",obj.nombre),"apellidos"in obj&&formData.append("params[0][lastname]",obj.apellidos),xhr.open("POST",url,!0),setTimeout((()=>{xhr.send(formData)}),100),xhr.onload=ev=>{reqHandlerGetUsers(xhr)},xhr.onloadstart=event=>{},xhr.onprogress=event=>{},xhr.onloadend=event=>{},xhr.onerror=()=>{}},reqHandlerGetUsers=xhr=>{if(4===xhr.readyState&&200===xhr.status&&xhr.response){const response=JSON.parse(xhr.response);loadTemplateFromResponse(response)}},loadTemplateFromResponse=response=>{Templates.renderForPromise("local_ticketmanagement/users/table-users-ajax",response).then((_ref=>{let{html:html,js:js}=_ref;const content=document.querySelector("#content");content.innerHTML="",Templates.appendNodeContents(content,html,js);const orderlinks=document.querySelectorAll(".orderby");orderlinks.forEach((link=>{link.addEventListener("click",(ev=>{ev.preventDefault();const token=document.querySelector('input[name="token"]').value,orderby=document.querySelector('input[name="orderby"]'),order=document.querySelector('input[name="order"]');"activo"===ev.target.dataset.activo?"1"===order.value?(ev.target.dataset.order=0,order.value=0):(ev.target.dataset.order=1,order.value=1):(orderlinks.forEach((link=>{link.dataset.activo=""})),ev.target.dataset.activo="activo",orderby.value=ev.target.dataset.orderby,ev.target.dataset.order=1,order.value=1);const groupid=document.querySelector("#id_vessel").value,customerid=document.querySelector("#id_project").value,obj={activePage:1,order:order.value,orderby:orderby.value,page:1,groupid:groupid,customerid:customerid},billid=document.querySelector("#tebillid").value,nombre=document.querySelector("#tenombre").value,apellidos=document.querySelector("#teapellidos").value;""===billid&&""===nombre&&""===apellidos||(obj.billid=billid,obj.nombre=nombre,obj.apellidos=apellidos),requestDataToServer(obj,token,url)}))}));document.querySelectorAll(".page-link").forEach((page=>{page.addEventListener("click",(ev=>{ev.preventDefault(),ev.stopPropagation();const token=document.querySelector('input[name="token"]').value,page=document.querySelector('input[name="page"]'),padre=ev.currentTarget.parentElement;"first"===padre.dataset.control||"last"===padre.dataset.control||"previous"===padre.dataset.control||"next"===padre.dataset.control?page.value=ev.currentTarget.getAttribute("aria-label"):page.value=ev.currentTarget.textContent.trim();const orderby=document.querySelector('input[name="orderby"]').value,order=document.querySelector('input[name="order"]').value,activePage=parseInt(page.value),groupid=document.querySelector("#id_vessel").value,customerid=document.querySelector("#id_project").value,obj={activePage:activePage,order:order,orderby:orderby,page:page.value,groupid:groupid,customerid:customerid},billid=document.querySelector("#tebillid").value,nombre=document.querySelector("#tenombre").value,apellidos=document.querySelector("#teapellidos").value;""===billid&&""===nombre&&""===apellidos||(obj.billid=billid,obj.nombre=nombre,obj.apellidos=apellidos),requestDataToServer(obj,token,url)}))}))})).catch((error=>displayException(error)))};return{loadTemplate:()=>{const url=M.cfg.wwwroot+"/webservice/rest/server.php";funcionesComunes.areElementsLoaded('#id_project,#id_vessel,input[name="token"]').then((elements=>{const token=document.querySelector('input[name="token"]').value;document.querySelector("#id_boshow").addEventListener("click",(()=>{const newPage=document.querySelector('input[name="page"]');newPage.value=1;const orderby=document.querySelector('input[name="orderby"]').value,order=document.querySelector('input[name="order"]').value,groupid=document.querySelector("#id_vessel").value,customerid=document.querySelector("#id_project").value,obj={activePage:1,order:order,orderby:orderby,page:newPage.value,groupid:groupid,customerid:customerid};requestDataToServer(obj,token,url)}));document.querySelector("#id_bosearchdate").addEventListener("click",(()=>{const newPage=document.querySelector('input[name="page"]');newPage.value=1;const orderby=document.querySelector('input[name="orderby"]').value,order=document.querySelector('input[name="order"]').value,groupid=document.querySelector("#id_vessel").value,customerid=document.querySelector("#id_project").value,billid=document.querySelector("#tebillid").value,nombre=document.querySelector("#tenombre").value,apellidos=document.querySelector("#teapellidos").value,obj={activePage:1,order:order,orderby:orderby,page:newPage.value,groupid:groupid,customerid:customerid,billid:billid,nombre:nombre,apellidos:apellidos};requestDataToServer(obj,token,url)}))}))}}}));

//# sourceMappingURL=init.min.js.map