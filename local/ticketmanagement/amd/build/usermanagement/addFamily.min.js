define("local_ticketmanagement/usermanagement/addFamily",["core_form/modalform","local_ticketmanagement/funciones_comunes"],(function(ModalForm,funcionesComunes){M.cfg.wwwroot,document.querySelector('input[name="token"]').value;const showFamilyFormPopup=e=>{e.stopPropagation();const userid=e.target.closest(".modify-family").dataset.userid,modalForm=new ModalForm({formClass:"\\local_ticketmanagement\\form\\".concat("FamilyFormPopup"),args:{userid:userid},modalConfig:{title:"User details: #".concat(userid)},returnFocus:e.target});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{e.target})),modalForm.addEventListener(modalForm.events.LOADED,(e=>{const formElement=e.target;funcionesComunes.areElementsLoaded('input[name="token"],button[class="edit-family"]',formElement).then((elements=>{const url=M.cfg.wwwroot+"/webservice/rest/server.php",token=document.querySelector('input[name="token"]').value;formElement.querySelectorAll(".edit-family").forEach((button=>{button.addEventListener("click",(e=>{const familyId=e.target.dataset.id,famId="#family_"+familyId,firstname=formElement.querySelector(famId+' input[name="tefaname"]').value,lastname=formElement.querySelector(famId+' input[name="tefalastname"]').value,relationship=formElement.querySelector(famId+" select").value;editFamiliar(familyId,relationship,firstname,lastname,token,url)}))}));document.querySelectorAll(".view-family").forEach((boviewfamily=>{boviewfamily.addEventListener("click",(e=>{(e=>{e.stopPropagation();const familiarid=e.target.dataset.id,modalForm=new ModalForm({formClass:"\\local_ticketmanagement\\form\\".concat("ViewFamilyFormPopup"),args:{userid:familiarid},modalConfig:{title:"User details: #".concat(familiarid)},returnFocus:e.target});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{const formElement=document.querySelector("#family_form"),role=e.detail.data.relationship;formElement.querySelector('select[name="selrole"]').value=role;const name=e.detail.data.name;formElement.querySelector('input[name="tefaname"]').value=name;const lastname=e.detail.data.lastname;formElement.querySelector('input[name="tefalastname"]').value=lastname})),modalForm.addEventListener(modalForm.events.LOADED,(e=>{const formElement=e.target;funcionesComunes.areElementsLoaded('input[name="token"],button[class="edit-family"]',formElement).then((elements=>{M.cfg.wwwroot,document.querySelector('input[name="token"]').value}))})),modalForm.show()})(e)}))}))}))}));const editFamiliar=(id,relationship,firstname,lastname,token,url)=>{let xhr=new XMLHttpRequest;const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","local_ticketmanagement_edit_family_members"),formData.append("moodlewsrestformat","json"),formData.append("params[0][id]",id),formData.append("params[0][relationship]",relationship),formData.append("params[0][firstname]",firstname),formData.append("params[0][lastname]",lastname),xhr.open("POST",url,!0),xhr.send(formData),xhr.onload=ev=>{reqHandlerEditFamiliar(xhr)},xhr.onerror=()=>{rejectAnswer(xhr)}},reqHandlerEditFamiliar=xhr=>{if(4===xhr.readyState&&200===xhr.status&&xhr.response){JSON.parse(xhr.response)}};modalForm.show()};return{init:()=>{document.querySelectorAll(".modify-family").forEach((boaddfamily=>{boaddfamily.addEventListener("click",(e=>{showFamilyFormPopup(e)}))}))}}}));

//# sourceMappingURL=addFamily.min.js.map