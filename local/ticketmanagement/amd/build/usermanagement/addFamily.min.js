define("local_ticketmanagement/usermanagement/addFamily",["core_form/modalform","local_ticketmanagement/funciones_comunes"],(function(ModalForm,funcionesComunes){M.cfg.wwwroot,document.querySelector('input[name="token"]').value;const showFamilyFormPopup=e=>{e.stopPropagation();const userid=e.target.closest(".modify-family").dataset.userid,modalForm=new ModalForm({formClass:"\\local_ticketmanagement\\form\\".concat("FamilyFormPopup"),args:{userid:userid},modalConfig:{title:"User details: #".concat(userid)},returnFocus:e.target});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{e.target;window.console.log(e.detail)})),modalForm.addEventListener(modalForm.events.LOADED,(e=>{const formElement=e.target;funcionesComunes.areElementsLoaded('input[name="token"],button[class="edit-family"]',formElement).then((elements=>{const url=M.cfg.wwwroot+"/webservice/rest/server.php",token=document.querySelector('input[name="token"]').value;formElement.querySelectorAll(".edit-family").forEach((button=>{button.addEventListener("click",(e=>{const familyId=e.target.dataset.id,firstname=prompt("Enter first name of the family member:"),lastname=prompt("Enter last name of the family member:"),relationship=prompt("Enter relationship to the trainee:");if(window.console.log(token),firstname&&lastname&&relationship){let xhr=new XMLHttpRequest;const service="edit_family_members",formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction",service),formData.append("moodlewsrestformat","json"),formData.append("params[0][id]",familyId),formData.append("params[0][firstname]",firstname),formData.append("params[0][lastname]",lastname),formData.append("params[0][relationship]",relationship),xhr.open("POST",url,!0),xhr.onreadystatechange=function(){if(4===xhr.readyState)if(200===xhr.status)try{const response=JSON.parse(xhr.responseText);if(response.errorcode)alert("Error: ".concat(response.message));else{const family=response.listadoFamily;alert("Family member updated successfully:\n                                                        ID: ".concat(family.id,"\n                                                        Name: ").concat(family.name,"\n                                                        Last Name: ").concat(family.lastname,"\n                                                        Relationship: ").concat(family.relationship)),location.reload()}}catch(err){console.error("Error parsing response:",err),alert("An unexpected error occurred.")}else console.error("Request failed:",xhr.status,xhr.statusText),alert("Failed to update the family member.")},xhr.send(url)}else alert("All fields are required.")}))}))}))})),modalForm.show()};return{init:()=>{document.querySelectorAll(".modify-family").forEach((boaddfamily=>{boaddfamily.addEventListener("click",(e=>{showFamilyFormPopup(e)}))}))}}}));

//# sourceMappingURL=addFamily.min.js.map