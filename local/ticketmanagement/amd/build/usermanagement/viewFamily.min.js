define("local_ticketmanagement/usermanagement/viewFamily",["core_form/modalform","local_ticketmanagement/funciones_comunes"],(function(ModalForm,funcionesComunes){M.cfg.wwwroot,document.querySelector('input[name="token"]').value;const showViewFamilyFormPopup=e=>{e.stopPropagation();const familiarid=e.target.closest(".view-family").dataset.userid,modalForm=new ModalForm({formClass:"\\local_ticketmanagement\\form\\".concat("ViewFamilyFormPopup"),args:{userid:userid},modalConfig:{title:"family details: #".concat(familiarid)},returnFocus:e.target});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{e.target;window.console.log(e.detail)})),modalForm.addEventListener(modalForm.events.LOADED,(e=>{const formElement=e.target;funcionesComunes.areElementsLoaded('input[name="token"],button[class="edit-family"]',formElement).then((elements=>{const url=M.cfg.wwwroot+"/webservice/rest/server.php",token=document.querySelector('input[name="token"]').value;formElement.querySelectorAll(".edit-family").forEach((button=>{button.addEventListener("click",(e=>{const familyId=e.target.dataset.id,famId="#family_"+familyId,firstname=formElement.querySelector(famId+' input[name="tefaname"]').value,lastname=formElement.querySelector(famId+' input[name="tefalastname"]').value,relationship=formElement.querySelector(famId+" select").value;editFamiliar(familyId,relationship,firstname,lastname,token,url)}))}))}))}));const editFamiliar=(id,relationship,firstname,lastname,token,url)=>{let xhr=new XMLHttpRequest;const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","local_ticketmanagement_edit_family_members"),formData.append("moodlewsrestformat","json"),formData.append("params[0][id]",id),formData.append("params[0][relationship]",relationship),formData.append("params[0][firstname]",firstname),formData.append("params[0][lastname]",lastname),xhr.open("POST",url,!0),xhr.send(formData),xhr.onload=ev=>{reqHandlerEditFamiliar(xhr)},xhr.onerror=()=>{rejectAnswer(xhr)}},reqHandlerEditFamiliar=xhr=>{if(4===xhr.readyState&&200===xhr.status&&xhr.response){const response=JSON.parse(xhr.response);response&&window.console.log(response)}};modalForm.show()};return{init:()=>{document.querySelectorAll(".view-family").forEach((boaddfamily=>{boviewfamily.addEventListener("click",(e=>{windows.console.log(e),showViewFamilyFormPopup(e)}))}))}}}));

//# sourceMappingURL=viewFamily.min.js.map