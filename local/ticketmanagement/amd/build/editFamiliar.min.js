define("local_ticketmanagement/editFamiliar",["exports","core_form/modalform","core/notification","core/templates","core/modal_events","core/str"],(function(_exports,_modalform,_notification,_templates,_modal_events,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_modalform=_interopRequireDefault(_modalform),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates),_modal_events=_interopRequireDefault(_modal_events);const url=M.cfg.wwwroot+"/webservice/rest/server.php",token=document.querySelector('input[name="token"]').value;_exports.init=()=>{document.querySelectorAll(".edit").forEach((elem=>{elem.addEventListener("click",(e=>{window.console.log(e);const id=e.target.dataset.id;showEditFamilyPopup(id)}))}))};const showEditFamilyPopup=id=>{const modalForm=new _modalform.default({formClass:"\\local_ticketmanagement\\form\\EditFamiliarFormPopup",args:{id:id},modalConfig:{title:"Edit Family member"},returnFocus:e.target});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(e=>{const userid=e.detail.userid,relationship=e.detail.selrelationship,firstname=e.detail.firstname,lastname=e.detail.lastname;addFamiliar(userid,relationship,firstname,lastname,token,url)})),modalForm.addEventListener(modalForm.events.LOADED,(e=>{})),modalForm.show()},addFamiliar=(userid,relationship,firstname,lastname,token,url)=>{let xhr=new XMLHttpRequest;const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","local_ticketmanagement_add_family_members"),formData.append("moodlewsrestformat","json"),formData.append("params[0][userid]",userid),formData.append("params[0][relationship]",relationship),formData.append("params[0][firstname]",firstname),formData.append("params[0][lastname]",lastname),xhr.open("POST",url,!0),xhr.send(formData),xhr.onload=ev=>{reqHandlerAddFamiliar(xhr)},xhr.onerror=()=>{rejectAnswer(xhr)}},reqHandlerAddFamiliar=xhr=>{if(4===xhr.readyState&&200===xhr.status&&xhr.response){const response=JSON.parse(xhr.response);response&&(window.console.log(response),addFamiliarToTemplate(response))}},addFamiliarToTemplate=response=>{_templates.default.renderForPromise("local_ticketmanagement/tr_family",response).then((_ref=>{let{html:html,js:js}=_ref;const content=document.querySelector("#tablebody");_templates.default.appendNodeContents(content,html,js)})).catch((error=>displayException(error)))}}));

//# sourceMappingURL=editFamiliar.min.js.map