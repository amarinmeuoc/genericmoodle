{"version":3,"file":"checklogs.min.js","sources":["../../src/user/checklogs.js"],"sourcesContent":["import {exception as displayException} from 'core/notification';  \nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\nimport ModalForm from 'core_form/modalform';\nimport ModalFactory from 'core/modal';\n\nconst url=M.cfg.wwwroot+'/webservice/rest/server.php';\nconst token=document.querySelector('input[name=\"token\"]').value;\nexport const init =() => {\n    \n    const logs=document.querySelectorAll('.logs');\n\n    logs.forEach((node)=>{\n        node.addEventListener('click',(e)=>{\n            showTicketActions(e);\n        })\n    })\n}\n\nconst showTicketActions=(e)=>{\n    e.stopPropagation();\n    const ticketId=e.target.dataset.ticketid;\n    let xhr = new XMLHttpRequest();\n    \n    //Se prepara el objeto a enviar\n    const formData= new FormData();\n    formData.append('wstoken',token);\n    formData.append('wsfunction', 'local_ticketmanagement_load_actions');\n    formData.append('moodlewsrestformat', 'json');\n    formData.append('params[0][ticketid]',ticketId);\n    \n\n    xhr.open('POST',url,true);\n    xhr.send(formData);\n\n    xhr.onload = (ev)=> {\n        reqHandlerLoadActions(xhr);\n    }\n\n    xhr.onerror = ()=> {\n        rejectAnswer(xhr);\n    }\n}\n\nconst reqHandlerLoadActions=(xhr)=>{\n    if (xhr.readyState === 4 && xhr.status === 200) {\n        if (xhr.response) {\n            const response = JSON.parse(xhr.response);\n            loadActionsTemplate(response);\n            window.console.log(response);\n        }\n    }\n}\n\nconst loadActionsTemplate=(response)=>{\n    const modalContent = `\n      <div class=\"modal-body\">\n        <p>This is the list of actions ordered by date</p>\n    </div>\n    <div class=\"table-responsive\" style=\"max-height:300px\">\n        <table class=\"generaltable table-sm\">\n            <thead>\n                <tr>\n                    <th>Date</th>\n                    <th>Task</th>\n                    <th>Done by</th>\n                </tr>\n            </thead>\n            <tbody>\n                ` + \n                response.map(action => {\n                    \n                    return `\n                        <tr>\n                            <td>${action.dateaction}</td>\n                            <td>${action.action}</td>\n                            <td>${action.user}</td>\n                        </tr>\n                    `;\n                }).join('') + // Unir todas las filas generadas\n                `</tbody>\n        </table>\n    </div>\n    <div class=\"modal-footer\">\n        <button type=\"button\" class=\"btn btn-primary\" data-action=\"confirm\">Accept</button>\n    </div>`;\n\n    ModalFactory.create({\n        title: 'Actions history',\n        body: modalContent,\n        size: 'modal-xl'\n    }).then(modal => {\n        window.console.log(modal);\n        // Manejar el clic en Aceptar\n        modal.getRoot()[0].querySelector('[data-action=\"confirm\"]').onclick = function() {\n            \n            modal.hide(); // Cierra el modal\n        };\n        modal.show(); // Muestra el modal\n    });\n}"],"names":["url","M","cfg","wwwroot","token","document","querySelector","value","querySelectorAll","forEach","node","addEventListener","e","showTicketActions","stopPropagation","ticketId","target","dataset","ticketid","xhr","XMLHttpRequest","formData","FormData","append","open","send","onload","ev","reqHandlerLoadActions","onerror","rejectAnswer","readyState","status","response","JSON","parse","loadActionsTemplate","window","console","log","modalContent","map","action","dateaction","user","join","create","title","body","size","then","modal","getRoot","onclick","hide","show"],"mappings":"s6CAMMA,IAAIC,EAAEC,IAAIC,QAAQ,8BAClBC,MAAMC,SAASC,cAAc,uBAAuBC,oBACvC,KAEJF,SAASG,iBAAiB,SAEhCC,SAASC,OACVA,KAAKC,iBAAiB,SAASC,IAC3BC,kBAAkBD,gBAKxBC,kBAAmBD,IACrBA,EAAEE,wBACIC,SAASH,EAAEI,OAAOC,QAAQC,aAC5BC,IAAM,IAAIC,qBAGRC,SAAU,IAAIC,SACpBD,SAASE,OAAO,UAAUnB,OAC1BiB,SAASE,OAAO,aAAc,uCAC9BF,SAASE,OAAO,qBAAsB,QACtCF,SAASE,OAAO,sBAAsBR,UAGtCI,IAAIK,KAAK,OAAOxB,KAAI,GACpBmB,IAAIM,KAAKJ,UAETF,IAAIO,OAAUC,KACVC,sBAAsBT,MAG1BA,IAAIU,QAAU,KACVC,aAAaX,OAIfS,sBAAuBT,SACF,IAAnBA,IAAIY,YAAmC,MAAfZ,IAAIa,QACxBb,IAAIc,SAAU,OACRA,SAAWC,KAAKC,MAAMhB,IAAIc,UAChCG,oBAAoBH,UACpBI,OAAOC,QAAQC,IAAIN,YAKzBG,oBAAqBH,iBACjBO,aAAe,kcAeTP,SAASQ,KAAIC,kFAIKA,OAAOC,6DACPD,OAAOA,yDACPA,OAAOE,qEAGtBC,KAAK,qMAQPC,OAAO,CAChBC,MAAO,kBACPC,KAAMR,aACNS,KAAM,aACPC,MAAKC,QACJd,OAAOC,QAAQC,IAAIY,OAEnBA,MAAMC,UAAU,GAAG9C,cAAc,2BAA2B+C,QAAU,WAElEF,MAAMG,QAEVH,MAAMI"}