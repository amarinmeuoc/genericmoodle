define("local_ticketmanagement/user/init_st",["exports","core/notification","core/templates"],(function(_exports,_notification,_templates){var obj;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.loadTemplate=void 0,_templates=(obj=_templates)&&obj.__esModule?obj:{default:obj};_exports.loadTemplate=()=>{const url=M.cfg.wwwroot+"/webservice/rest/server.php";areElementsLoaded('input[name="user"],#id_category, #id_subcategory,input[name="token"],#startdate,#enddate').then((elements=>{const token=document.querySelector('input[name="token"]').value,orderby=document.querySelector('input[name="orderby"]').value,order=document.querySelector('input[name="order"]').value,page=document.querySelector('input[name="page"]').value,userid=document.querySelector('input[name="user"]').value;requestDataToServer(1,userid,order,orderby,page,token,url)}))};const requestDataToServer=(activePage,userid,order,orderby,page,token,url)=>{let xhr=new XMLHttpRequest;const formData=new FormData;formData.append("wstoken",token),formData.append("wsfunction","local_ticketmanagement_get_tickets_byUserId"),formData.append("moodlewsrestformat","json"),formData.append("params[0][order]",order),formData.append("params[0][orderby]",orderby),formData.append("params[0][page]",page),formData.append("params[0][userid]",userid),formData.append("params[0][activePage]",activePage),xhr.open("POST",url,!0),xhr.send(formData),xhr.onload=ev=>{reqHandlerGetTickets(xhr)},xhr.onerror=()=>{rejectAnswer(xhr)}},reqHandlerGetTickets=xhr=>{if(4===xhr.readyState&&200===xhr.status&&xhr.response){const response=JSON.parse(xhr.response);window.console.log(response),loadTemplatefromResponse(response)}},loadTemplatefromResponse=response=>{_templates.default.renderForPromise("local_ticketmanagement/content_user-ajax",response).then((_ref=>{let{html:html,js:js}=_ref;const content=document.querySelector("#content");content.innerHTML="",_templates.default.appendNodeContents(content,html,js);const orderlinks=document.querySelectorAll(".orderby");orderlinks.forEach((link=>{link.addEventListener("click",(ev=>{ev.preventDefault();const token=document.querySelector('input[name="token"]').value,page=document.querySelector('input[name="page"]'),orderby=document.querySelector('input[name="orderby"]'),order=document.querySelector('input[name="order"]');"activo"===ev.target.dataset.activo?"1"===order.value?(ev.target.dataset.order=0,order.value=0):(ev.target.dataset.order=1,order.value=1):(orderlinks.forEach((link=>{link.dataset.activo=""})),ev.target.dataset.activo="activo",orderby.value=ev.target.dataset.orderby,ev.target.dataset.order=1,order.value=1);const activePage=document.querySelector("li.page-item.active>a").textContent.trim(),userid=document.querySelector('input[name="user"]').value;requestDataToServer(activePage,userid,parseInt(order.value),orderby.value,page.value,token,url)}))}));document.querySelectorAll(".page-link").forEach((page=>{page.addEventListener("click",(ev=>{ev.preventDefault(),ev.stopPropagation();const token=document.querySelector('input[name="token"]'),page=document.querySelector('input[name="page"]'),padre=ev.currentTarget.parentElement;"first"===padre.dataset.control||"last"===padre.dataset.control||"previous"===padre.dataset.control||"next"===padre.dataset.control?page.value=ev.currentTarget.getAttribute("aria-label"):page.value=ev.currentTarget.textContent.trim();const orderby=document.querySelector('input[name="orderby"]').value,order=document.querySelector('input[name="order"]').value,activePage=parseInt(page.value),userid=document.querySelector('input[name="user"]').value;requestDataToServer(activePage,userid,parseInt(order),orderby,parseInt(page.value),token.value,url)}))}))})).catch((error=>(0,_notification.exception)(error)))},areElementsLoaded=selector=>new Promise((resolve=>{const checkElements=()=>{const elements=document.querySelectorAll(selector);elements.length>0&&Array.from(elements).every((elem=>null!==elem))?resolve(elements):requestAnimationFrame(checkElements)};checkElements()}))}));

//# sourceMappingURL=init_st.min.js.map